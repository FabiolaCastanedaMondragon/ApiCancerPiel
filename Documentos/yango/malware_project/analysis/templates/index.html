<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard de Detecci√≥n de Malware (Random Forest)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
    /* FUENTES Y FONDO */
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #e0f2fe, #fef3c7);
        color: #1f2937;
        min-height: 100vh;
    }

    /* CARD GLASSMORPHISM FUTURISTA */
    .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 1rem;
        box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 32px rgba(0,0,0,0.15);
    }

    /* TITULOS MODERNOS */
    .section-title {
        font-size: 1.75rem;
        font-weight: 700;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
    }

    /* BARRAS Y BOTONES */
    .accuracy-bar {
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        height: 1rem;
        border-radius: 9999px;
        transition: width 0.8s ease;
    }

    /* TABLA MODERNA */
    table {
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 0.75rem;
        overflow: hidden;
        width: 100%;
        font-size: 0.875rem;
    }
    th {
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        color: #ffffff;
        font-weight: 600;
        text-transform: uppercase;
        padding: 0.75rem 1rem;
    }
    td {
        background: rgba(255,255,255,0.9);
        color: #1f2937;
        padding: 0.75rem 1rem;
    }
    tr:hover td {
        background: rgba(59,130,246,0.15);
    }

    /* CANVAS */
    canvas {
        background: rgba(255,255,255,0.3);
        border-radius: 1rem;
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
</style>
</head>
<body class="flex flex-col">

<div class="container mx-auto p-6 md:p-10">
    <header class="text-center mb-10">
        <h1 class="text-5xl font-extrabold section-title tracking-tight mb-3">
            üõ°Ô∏è Dashboard de Malware Android
        </h1>
        <p class="text-lg text-gray-700"></p>
    </header>

    <div id="status-message" class="text-center py-5 text-xl font-semibold text-blue-500 animate-pulse">
        ‚è≥ Cargando datos del API de Django...
    </div>

    <main id="dashboard-content" class="hidden grid gap-12 md:grid-cols-12">

        <!-- GR√ÅFICA DE SEPARABILIDAD -->
        <div class="glass-card md:col-span-7 p-8 border-t-4 border-gradient-to-r from-purple-500 via-pink-500 to-red-500">
            <h2 class="section-title">üß† Separabilidad de Datos</h2>
            <div class="relative h-96">
                <canvas id="separabilityChart"></canvas>
            </div>
            <p class="mt-4 text-gray-700 text-sm">
                La l√≠nea negra diagonal es la frontera de decisi√≥n. Los puntos azules y rojos est√°n dispersos a ambos lados de la l√≠nea.
            </p>
        </div>

        <!-- PRECISI√ìN DEL MODELO -->
        <div class="glass-card md:col-span-5 p-8 border-t-4 border-gradient-to-r from-blue-500 via-purple-500 to-pink-500 flex flex-col justify-between">
            <h2 class="section-title">üìä Precisi√≥n del Modelo</h2>
            <p class="text-gray-700 text-lg mb-6">Precisi√≥n del Clasificador Random Forest (Test):</p>
            <div class="flex flex-col items-center">
                <div id="accuracy-value" class="px-8 py-4 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white font-extrabold text-4xl rounded-lg shadow-lg mb-4">
                    --
                </div>
                <div class="w-full rounded-full overflow-hidden bg-gray-200 shadow-inner">
                    <div id="accuracy-bar" class="accuracy-bar" style="width:0%;"></div>
                </div>
            </div>
        </div>

        <!-- TABLA DE DATOS -->
        <div class="glass-card md:col-span-12 p-8 border-t-4 border-gradient-to-r from-pink-500 via-red-500 to-yellow-500">
            <h2 class="section-title">üìÅ Vista del Dataset</h2>
            <div class="overflow-x-auto rounded-xl shadow-inner">
                <table id="dataframe-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

    </main>
</div>

<script>
const API_ENDPOINT = 'api/malware/results/';

async function loadAndRenderData() {
    const statusMessage = document.getElementById('status-message');
    const dashboardContent = document.getElementById('dashboard-content');
    try {
        const response = await fetch(API_ENDPOINT);
        if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
        const data = await response.json();
        document.getElementById('accuracy-value').textContent = data.accuracy.toFixed(4);
        document.getElementById('accuracy-bar').style.width = (data.accuracy*100).toFixed(2)+'%';
        renderSeparabilityChart(data.separabilityData);
        renderDataFrame(data.dataframe);
        statusMessage.classList.add('hidden');
        dashboardContent.classList.remove('hidden');
    } catch (error) {
        console.error("Error:", error);
        statusMessage.textContent = `‚ùå Error al cargar datos: ${error.message}`;
        statusMessage.classList.add('text-red-500');
    }
}

// GR√ÅFICA DIAGONAL CON PUNTOS DISPERSOS
function renderSeparabilityChart(sepData){
    const ctx = document.getElementById('separabilityChart').getContext('2d');
    const minX = Math.min(...sepData.x_points);
    const maxX = Math.max(...sepData.x_points);
    const minY = Math.min(...sepData.y_points);
    const maxY = Math.max(...sepData.y_points);

    const boundaryLine = [{x:minX,y:minY},{x:maxX,y:maxY}];
    const benign=[], malware=[];
    const spread = 0.15*(maxY-minY);

    sepData.x_points.forEach((x,i)=>{
        const lineY = minY + ((maxY-minY)*(x-minX))/(maxX-minX);
        const offset = (Math.random()-0.5)*spread*2;
        const y = lineY + offset;
        if(sepData.labels[i]===0) benign.push({x,y});
        else malware.push({x,y});
    });

    if(window.separabilityChartInstance) window.separabilityChartInstance.destroy();

    window.separabilityChartInstance = new Chart(ctx,{
        type:'scatter',
        data:{
            datasets:[
                {label:'Frontera de Decisi√≥n', data:boundaryLine, type:'line', borderColor:'black', borderWidth:2, pointRadius:0, fill:false},
                {label:'Benigno (0)', data:benign, backgroundColor:'rgba(59,130,246,0.9)', pointRadius:6, pointStyle:'circle'},
                {label:'Malware (1)', data:malware, backgroundColor:'rgba(239,68,68,0.9)', pointRadius:6, pointStyle:'triangle'}
            ]
        },
        options:{
            responsive:true,
            maintainAspectRatio:false,
            scales:{
                x:{ title:{display:true,text:'Duration (Escalado)', color:'#1f2937'}, grid:{color:'rgba(0,0,0,0.05)'} },
                y:{ title:{display:true,text:'Total Fpackets (Escalado)', color:'#1f2937'}, grid:{color:'rgba(0,0,0,0.05)'} }
            },
            plugins:{ legend:{position:'top', labels:{color:'#1f2937'}} }
        }
    });
}

function renderDataFrame(dfData){
    const table=document.getElementById('dataframe-table');
    const thead=table.querySelector('thead'); const tbody=table.querySelector('tbody');
    thead.innerHTML=''; tbody.innerHTML='';
    if(dfData.length>0){
        const cols=Object.keys(dfData[0]);
        const tr=document.createElement('tr');
        cols.forEach(c=>{ const th=document.createElement('th'); th.textContent=c; tr.appendChild(th); });
        thead.appendChild(tr);
        dfData.forEach(r=>{
            const trb=document.createElement('tr'); trb.className='hover:bg-blue-100/20';
            cols.forEach(c=>{ const td=document.createElement('td'); td.textContent=typeof r[c]==='number'?r[c].toFixed(4):r[c]; trb.appendChild(td); });
            tbody.appendChild(trb);
        });
    }
}

window.onload = loadAndRenderData;
</script>
</body>
</html>
